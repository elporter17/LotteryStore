<!-- PANEL DE ADMINISTRACIÓN CON ACORDEÓN -->
<div class="admin-interface">
  
  <!-- Header -->
  <div class="header-bar">
    <div class="admin-title">
      <h2><i class="fas fa-cog"></i> Panel de Administración</h2>
    </div>
    
    <div class="header-actions">
      <button class="btn-header btn-users" (click)="navigateToUsers()" [disabled]="isLoading">
        <i class="fas fa-users"></i> Gestión de Usuarios
      </button>
      
      <button class="btn-header btn-cerrar" (click)="logout()" [disabled]="isLoading">
        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
      </button>
    </div>
  </div>

  <!-- Filtros de Fecha -->
  <div class="filters-bar">
    <div class="filter-group">
      <label for="fechaDesde">
        <i class="fas fa-calendar-alt"></i>
        Desde:
        <span class="loading-indicator" *ngIf="isLoadingFilters">
          <i class="fas fa-spinner fa-spin"></i>
        </span>
      </label>
      <input type="datetime-local" id="fechaDesde" class="form-control" 
             [(ngModel)]="fechaDesde" (change)="onFiltroFechaChange()"
             [disabled]="isLoadingFilters">
    </div>
    
    <div class="filter-group">
      <label for="fechaHasta">
        <i class="fas fa-calendar-alt"></i>
        Hasta:
        <span class="loading-indicator" *ngIf="isLoadingFilters">
          <i class="fas fa-spinner fa-spin"></i>
        </span>
      </label>
      <input type="datetime-local" id="fechaHasta" class="form-control" 
             [(ngModel)]="fechaHasta" (change)="onFiltroFechaChange()"
             [disabled]="isLoadingFilters">
    </div>
    
    <div class="filter-group">
      <label for="sorteoFilter">
        <i class="fas fa-trophy"></i>
        Sorteo:
        <span class="loading-indicator" *ngIf="isLoadingFilters">
          <i class="fas fa-spinner fa-spin"></i>
        </span>
      </label>
      <select id="sorteoFilter" class="form-control" 
              [(ngModel)]="selectedSorteoFilter" (change)="aplicarFiltros()"
              [disabled]="isLoadingFilters">
        <option value="">Todos los sorteos</option>
        <option *ngFor="let sorteo of sorteos" [value]="sorteo.name">{{ sorteo.label }}</option>
      </select>
    </div>
    
    <div class="filter-actions">
      <button class="btn-filter btn-primary" (click)="aplicarFiltros()" [disabled]="isLoading || isLoadingFilters">
        <i class="fas fa-spinner fa-spin" *ngIf="isLoadingFilters; else searchIcon"></i>
        <ng-template #searchIcon><i class="fas fa-search"></i></ng-template>
        {{ isLoadingFilters ? 'Filtrando...' : 'Filtrar' }}
      </button>
      <button class="btn-filter btn-secondary" (click)="limpiarFiltros()" [disabled]="isLoading || isLoadingFilters">
        <i class="fas fa-spinner fa-spin" *ngIf="isLoadingFilters; else eraserIcon"></i>
        <ng-template #eraserIcon><i class="fas fa-eraser"></i></ng-template>
        {{ isLoadingFilters ? 'Limpiando...' : 'Limpiar' }}
      </button>
    </div>

    <!-- Botones de Exportación -->
    <div class="export-actions">
      <div class="export-label">
        <i class="fas fa-download"></i>
        Descargar Reporte Diario:
      </div>
      <button class="btn-export btn-excel" (click)="downloadDailyReportExcel()" [disabled]="isLoading">
        <i class="fas fa-spinner fa-spin" *ngIf="isLoading; else excelIcon"></i>
        <ng-template #excelIcon><i class="fas fa-file-excel"></i></ng-template>
        Excel
      </button>
      <button class="btn-export btn-pdf" (click)="downloadDailyReportPDF()" [disabled]="isLoading">
        <i class="fas fa-spinner fa-spin" *ngIf="isLoading; else pdfIcon"></i>
        <ng-template #pdfIcon><i class="fas fa-file-pdf"></i></ng-template>
        PDF
      </button>
    </div>
  </div>

  <!-- Contenido Principal -->
  <div class="main-content">
    
    <!-- Cards de Resumen -->
    <div class="summary-cards">
      <div class="summary-card vendido">
        <div class="card-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="card-content">
          <h3>L {{ getTotalVendido().toFixed(2) }}</h3>
          <p>Total Vendido</p>
        </div>
      </div>
      
      <div class="summary-card pagado">
        <div class="card-icon">
          <i class="fas fa-coins"></i>
        </div>
        <div class="card-content">
          <h3>L {{ getTotalPagado().toFixed(2) }}</h3>
          <p>Total Pagado</p>
        </div>
      </div>
      
      <div class="summary-card ganancia" [class.positive]="getGananciaNeta() > 0" [class.negative]="getGananciaNeta() < 0">
        <div class="card-icon">
          <i class="fas fa-piggy-bank"></i>
        </div>
        <div class="card-content">
          <h3>L {{ getGananciaNeta().toFixed(2) }}</h3>
          <p>Ganancia Neta</p>
        </div>
      </div>
      
      <div class="summary-card ventas">
        <div class="card-icon">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <div class="card-content">
          <h3>{{ getTotalVentas() }}</h3>
          <p>Ventas Totales</p>
        </div>
      </div>
    </div>

    <!-- Sección de Información del Número Ganador -->
    <div class="numero-ganador-section" *ngIf="resumenSucursales && resumenSucursales.length > 0">
      <div class="section-header">
        <h3><i class="fas fa-trophy"></i> Información del Número Ganador</h3>
        <div class="section-subtitle">Detalle de pagos por sucursal</div>
      </div>
      
      <div class="numero-ganador-card">
        <div class="numero-ganador-header">
          <div class="numero-display">
            <span class="numero-text">{{ resumenSucursales[0]?.numero_ganador || '00' }}</span>
            <span class="numero-label">Número Ganador</span>
          </div>
          <div class="totales-general">
            <div class="total-item">
              <span class="total-value">L {{ getTotalCantidadNumeroGanador().toFixed(2) }}</span>
              <span class="total-label">Total Comprado</span>
            </div>
            <div class="total-item">
              <span class="total-value">L {{ getTotalPagadoGeneral() }}</span>
              <span class="total-label">Total a Pagar</span>
            </div>
          </div>
        </div>
        
        <div class="sucursales-detalle">
          <div class="detalle-header">
            <span>Sucursal</span>
            <span>Factor</span>
            <span>Cantidad</span>
            <span>Pago</span>
          </div>
          <div class="detalle-row" *ngFor="let sucursal of resumenSucursales">
            <span class="sucursal-name">{{ sucursal.sucursal }}</span>
            <span class="factor-value">{{ sucursal.factor_multiplicador }}x</span>
            <span class="cantidad-value">L {{ (sucursal.cantidad_numero_ganador || 0).toFixed(2) }}</span>
            <span class="pago-value">L {{ ((sucursal.cantidad_numero_ganador || 0) * (sucursal.factor_multiplicador || 1)).toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Números Vendidos por Sorteo -->
    <div class="numeros-vendidos-section">
      <div class="section-header">
        <h3><i class="fas fa-chart-bar"></i> Números Vendidos por Sorteo</h3>
        <div class="section-subtitle">Vista en tiempo real de las ventas por sorteo</div>
      </div>
      
      <div class="sorteos-numeros-grid" *ngIf="sales.length > 0; else noVentasNumeros">
        <div *ngFor="let sorteoGroup of getNumbersSummaryBySorteoAndSucursal()" class="sorteo-numeros-card">
          <div class="sorteo-numeros-header">
            <h4>{{ sorteoGroup.sorteo }}</h4>
            <div class="sorteo-total">
              Total: L {{ getSorteoTotal(sorteoGroup).toFixed(2) }}
            </div>
          </div>
          
          <div class="sucursales-container">
            <div *ngFor="let sucursalGroup of sorteoGroup.sucursales" class="sucursal-group">
              <div class="sucursal-header">
                <h5>{{ sucursalGroup.sucursal }}</h5>
                <span class="sucursal-total">L {{ getSucursalTotal(sucursalGroup).toFixed(2) }}</span>
              </div>
              
              <!-- Top 5 números más vendidos -->
              <div class="top-numeros-section">
                <h6>
                  <i class="fas fa-trophy"></i>
                  Top 5 Números Más Vendidos
                </h6>
                <div class="top-numeros-grid">
                  <div class="top-numero-card" *ngFor="let numero of sucursalGroup.numeros.slice(0, 5); let i = index">
                    <div class="numero">{{ numero.numero.toString().padStart(2, '0') }}</div>
                    <div class="cantidad">L {{ numero.totalVendido.toFixed(2) }}</div>
                    <div class="posicion">#{{ i + 1 }}</div>
                  </div>
                </div>
              </div>

              <!-- Tablero completo de números 00-99 -->
              <div class="tablero-numeros">
                <h6>
                  <i class="fas fa-grid-3x3"></i>
                  Tablero Completo (00-99)
                </h6>
                <div class="numeros-grid-completo">
                  <div class="numero-cell" 
                       *ngFor="let num of getAllNumbers()"
                       [class]="getNumeroIntensity(sucursalGroup, num)"
                       [title]="'Número ' + num.toString().padStart(2, '0') + ': L ' + getNumeroVenta(sucursalGroup, num).toFixed(2)">
                    <span class="numero-label">{{ num.toString().padStart(2, '0') }}</span>
                    <span class="numero-venta">L {{ getNumeroVenta(sucursalGroup, num).toFixed(2) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #noVentasNumeros>
        <div class="no-data-message">
          <i class="fas fa-chart-bar"></i>
          <h4>No hay ventas por números para mostrar</h4>
          <p>Las estadísticas aparecerán cuando haya ventas registradas</p>
        </div>
      </ng-template>
    </div>

    <!-- Sección de Sorteos con estilo minimalista -->
    <div class="sorteos-section">
      <div class="section-header">
        <h3><i class="fas fa-dice"></i> Gestión de Sorteos</h3>
      </div>
      
      <div class="sorteos-grid">
        <div *ngFor="let sorteo of sorteos" class="sorteo-card">
          <div class="sorteo-header">
            <h4>{{ sorteo.label }}</h4>
            <div class="sorteo-status">
              <span class="status-badge" [class.open]="isSorteoOpen(sorteo)" [class.closed]="!isSorteoOpen(sorteo)">
                {{ isSorteoOpen(sorteo) ? 'Abierto' : 'Cerrado' }}
              </span>
              <span class="close-time">{{ sorteo.closeTime }}</span>
            </div>
          </div>
          
          <div class="sorteo-content">
            <!-- Mostrar resultados solo si hay datos GUARDADOS en BD -->
            <div *ngIf="hasSavedWinner(sorteo); else setWinner">
              <!-- Resultados del sorteo -->
              <div class="winner-section">
                <div class="winner-number">
                  <i class="fas fa-trophy"></i>
                  <span>{{ getSorteoData(sorteo)?.numeroGanador || 'N/A' }}</span>
                </div>
                <div class="factor">Factor: {{ getSorteoData(sorteo)?.factorMultiplicador || 70 }}</div>
              </div>
            
            </div>
            
            <ng-template #setWinner>
              <!-- Formulario para establecer ganador solo si no está abierto -->
              <div *ngIf="!isSorteoOpen(sorteo)" class="winner-form">
                <div class="form-group">
                  <label>Número Ganador:</label>
                  <input type="number" class="form-input" min="1" max="99" 
                         [(ngModel)]="winningNumbers[sorteo.name]" 
                         [disabled]="isLoading"
                         placeholder="Ingrese número (1-99)">
                </div>
                <button class="btn-set-winner" (click)="openFactorsModal(sorteo.name, +winningNumbers[sorteo.name])" 
                        [disabled]="!winningNumbers[sorteo.name] || isLoading">
                  <i class="fas fa-cog"></i> 
                  <span *ngIf="isLoading">Cargando...</span>
                  <span *ngIf="!isLoading">Configurar Factores</span>
                </button>
              </div>
              
              <!-- Mensaje cuando el sorteo está abierto -->
              <div *ngIf="isSorteoOpen(sorteo)" class="sorteo-open-message">
                <i class="fas fa-clock"></i>
                <span>Sorteo abierto - Esperando cierre</span>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <!-- Componente de Resumen de Sorteos -->
    <app-resumen-sorteos></app-resumen-sorteos>

  </div>
</div>

<!-- Modal para crear/editar usuario -->
<div class="modal fade" [class.show]="showUserModal" [style.display]="showUserModal ? 'block' : 'none'" 
     tabindex="-1" role="dialog" (click)="showUserModal && $event.target === $event.currentTarget && closeUserModal()">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-user"></i> {{ editingUser ? 'Editar Usuario' : 'Crear Usuario' }}
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeUserModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #userForm="ngForm">
          <div class="form-group">
            <label for="userEmail">Email:</label>
            <input type="email" id="userEmail" class="form-input" required
                   [(ngModel)]="userFormData.email" name="email" 
                   placeholder="usuario@ejemplo.com">
          </div>

          <div class="form-group">
            <label for="userName">Nombre:</label>
            <input type="text" id="userName" class="form-input"
                   [(ngModel)]="userFormData.nombre" name="nombre" 
                   placeholder="Nombre completo del usuario">
          </div>
          
          <div class="form-group" *ngIf="!editingUser">
            <label for="userPassword">Contraseña:</label>
            <input type="password" id="userPassword" class="form-input" required
                   [(ngModel)]="userFormData.password" name="password" 
                   placeholder="Contraseña segura">
          </div>
          
          <div class="form-group">
            <label for="userRole">Rol:</label>
            <select id="userRole" class="form-input" 
                    [(ngModel)]="userFormData.role" name="role" required>
              <option value="admin">Administrador</option>
              <option value="sucursal">Sucursal</option>
            </select>
          </div>
          
          <div class="form-group" *ngIf="userFormData.role === 'sucursal'">
            <label for="userSucursal">Sucursal:</label>
            <input type="text" id="userSucursal" class="form-input" 
                   [(ngModel)]="userFormData.sucursal" name="sucursal" 
                   placeholder="Nombre de la sucursal">
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="userFormData.active" name="active">
              <span class="checkmark"></span>
              Usuario Activo
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-secondary" (click)="closeUserModal()">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="button" class="btn-modal btn-primary" (click)="saveUser()" 
                [disabled]="!userForm.valid || isLoading">
          <i class="fas fa-save"></i> {{ editingUser ? 'Actualizar' : 'Crear' }}
        </button>
      </div>
    </div>
  </div>
</div>
 

<!-- Modal para cambiar contraseña de usuario -->
<div class="modal fade" [class.show]="showPasswordModal" [style.display]="showPasswordModal ? 'block' : 'none'" 
     tabindex="-1" role="dialog" (click)="showPasswordModal && $event.target === $event.currentTarget && closePasswordModal()">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-key"></i> Cambiar Contraseña
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closePasswordModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #passwordForm="ngForm">
          <div class="form-group">
            <label for="newPassword">Nueva Contraseña:</label>
            <input type="password" id="newPassword" class="form-input" required
                   [(ngModel)]="newPassword" name="newPassword" 
                   placeholder="Ingrese la nueva contraseña">
          </div>
          
          <div class="form-group">
            <label for="confirmPassword">Confirmar Contraseña:</label>
            <input type="password" id="confirmPassword" class="form-input" required
                   [(ngModel)]="confirmPassword" name="confirmPassword" 
                   placeholder="Confirme la nueva contraseña">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-secondary" (click)="closePasswordModal()">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="button" class="btn-modal btn-primary" (click)="changeUserPassword()" 
                [disabled]="!passwordForm.valid || newPassword !== confirmPassword || isLoading">
          <i class="fas fa-save"></i> Cambiar Contraseña
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DE DETALLES DE VENTA -->
<div class="modal" [style.display]="showSaleDetailModal ? 'flex' : 'none'" 
     [class.show]="showSaleDetailModal" 
     (keydown.escape)="closeSaleDetailModal()"
     tabindex="0">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-receipt"></i> Detalles de Venta</h3>
        <button type="button" class="btn-close" (click)="closeSaleDetailModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body" *ngIf="selectedSaleForDetail">
        <!-- Información General -->
        <div class="sale-info-grid">
          <div class="info-row">
            <span class="label">Recibo:</span>
            <span class="value">{{ selectedSaleForDetail.numeroRecibo }}</span>
          </div>
          <div class="info-row">
            <span class="label">Correlativo:</span>
            <span class="value">{{ selectedSaleForDetail.correlativo }}</span>
          </div>
          <div class="info-row">
            <span class="label">Fecha:</span>
            <span class="value">{{ formatDateTime(selectedSaleForDetail.createdAt) }}</span>
          </div>
          <div class="info-row">
            <span class="label">Sucursal:</span>
            <span class="value">{{ selectedSaleForDetail.sucursal }}</span>
          </div>
          <div class="info-row">
            <span class="label">Sorteo:</span>
            <span class="value text-capitalize">{{ selectedSaleForDetail.sorteo }}</span>
          </div>
          <div class="info-row total-row">
            <span class="label">Total:</span>
            <span class="value">L {{ selectedSaleForDetail.total.toFixed(2) }}</span>
          </div>
        </div>

        <!-- Números Jugados -->
        <div class="numbers-section" *ngIf="selectedSaleDetails.length > 0">
          <h4><i class="fas fa-list"></i> Números Jugados</h4>
          <div class="numbers-grid">
            <div class="number-item" *ngFor="let detail of selectedSaleDetails; trackBy: trackBySaleDetail">
              <div class="number-card">
                <div class="number">{{ detail.numero.toString().padStart(2, '0') }}</div>
                <div class="amount">L {{ detail.monto.toFixed(2) }}</div>
              </div>
            </div>
          </div>
          
          <div class="numbers-summary">
            <div class="summary-item">
              <span class="label">Cantidad de números:</span>
              <span class="value">{{ selectedSaleDetails.length }}</span>
            </div>
            <div class="summary-item">
              <span class="label">Total apostado:</span>
              <span class="value">L {{ getTotalNumeros().toFixed(2) }}</span>
            </div>
          </div>
        </div>
        
        <div class="no-numbers" *ngIf="selectedSaleDetails.length === 0">
          <i class="fas fa-exclamation-triangle"></i>
          <p>No se encontraron números para esta venta</p>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-primary" (click)="reprintReceipt(selectedSaleForDetail!)" 
                [disabled]="isLoading">
          <i class="fas fa-print"></i> Reimprimir Recibo
        </button>
        <button type="button" class="btn-modal btn-secondary" (click)="closeSaleDetailModal()">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal para configurar factores por sucursal -->
<div class="modal-overlay" *ngIf="showFactorsModal" (click)="closeFactorsModal()">
  <div class="modal-container factors-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-calculator"></i>
        Configurar Factores por Sucursal
      </h3>
      <div class="sorteo-info" *ngIf="currentSorteoForFactors">
        <div class="sorteo-badge">{{ currentSorteoForFactors.sorteo.label }}</div>
        <div class="winning-number">Número Ganador: {{ currentSorteoForFactors.winningNumber.padStart(2, '0') }}</div>
      </div>
      <button class="btn-close" (click)="closeFactorsModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="factors-instruction">
        <i class="fas fa-info-circle"></i>
        <p>Configure el factor multiplicador para cada sucursal. Este factor determinará cuánto se paga por cada número ganador.</p>
      </div>

      <div class="factors-list" *ngIf="sucursalesFactores.length > 0">
        <div class="factor-item" *ngFor="let sucursal of getUniqueSucursales(); let i = index">
          <div class="sucursal-info">
            <div class="sucursal-name">
              <i class="fas fa-store"></i>
              {{ sucursal }}
            </div>
            <div class="sucursal-users" *ngIf="hasSucursalUsers(sucursal)">
              <small>
                Usuarios: 
                <span *ngFor="let user of getUsersBySucursal(sucursal); let last = last">
                  {{ user.email }}{{ !last ? ', ' : '' }}
                </span>
              </small>
            </div>
          </div>
          
          <div class="factor-input">
            <label>Factor (ej: 70)</label>
            <div class="input-with-x">
              <input 
                type="number" 
                min="1" 
                max="999" 
                step="0.1"
                [value]="factoresPorSucursal[sucursal] || 75" 
                (input)="updateFactorForSucursal(sucursal, $any($event.target).value)"
                placeholder="70">
              <span class="x-multiplier">x</span>
            </div>
          </div>
        </div>
      </div>

      <div class="loading-factors" *ngIf="isLoading && sucursalesFactores.length === 0">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Cargando configuración de sucursales...</p>
      </div>

      <div class="no-sucursales" *ngIf="!isLoading && sucursalesFactores.length === 0">
        <i class="fas fa-exclamation-triangle"></i>
        <p>No se encontraron sucursales activas</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-modal btn-secondary" (click)="closeFactorsModal()" [disabled]="isLoading">
        <i class="fas fa-times"></i>
        Cancelar
      </button>
      <button class="btn-modal btn-primary" (click)="confirmWinningNumberWithFactors()" [disabled]="isLoading">
        <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
        <i class="fas fa-trophy" *ngIf="!isLoading"></i>
        {{ isLoading ? 'Estableciendo...' : 'Establecer Ganador' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal para mostrar resumen por sucursales -->
<div class="modal-overlay" *ngIf="showResumenModal" (click)="closeResumenModal()">
  <div class="modal-container resumen-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-chart-bar"></i>
        Resumen de Cierre por Sucursales
      </h3>
      <button type="button" class="btn-close" (click)="closeResumenModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="sorteo-info">
        <h4>{{ currentSorteoForResumen }}</h4>
      </div>
      
      <div class="resumen-table">
        <div class="table-header">
          <div class="col-sucursal">Sucursal</div>
          <div class="col-factor">Factor</div>
          <div class="col-numero-ganador">Cantidad #{{ resumenSucursales[0]?.numero_ganador || '00' }}</div>
          <div class="col-vendido">Total Vendido</div>
          <div class="col-pagado">Total Pagado</div>
          <div class="col-ganancia">Ganancia Neta</div>
        </div>
        
        <div class="table-row" *ngFor="let sucursal of resumenSucursales">
          <div class="col-sucursal">{{ sucursal.sucursal }}</div>
          <div class="col-factor">{{ sucursal.factor_multiplicador }}x</div>
          <div class="col-numero-ganador">
            <span class="cantidad-numero">L {{ (sucursal.cantidad_numero_ganador || 0).toFixed(2) }}</span>
            <small class="multiplicacion">x{{ sucursal.factor_multiplicador }} = L {{ ((sucursal.cantidad_numero_ganador || 0) * (sucursal.factor_multiplicador || 1)).toFixed(2) }}</small>
          </div>
          <div class="col-vendido">L {{ sucursal.total_vendido?.toFixed(2) || '0.00' }}</div>
          <div class="col-pagado">L {{ sucursal.total_pagado?.toFixed(2) || '0.00' }}</div>
          <div class="col-ganancia" 
               [class.positive]="(sucursal.ganancia_neta || 0) > 0"
               [class.negative]="(sucursal.ganancia_neta || 0) < 0">
            L {{ sucursal.ganancia_neta?.toFixed(2) || '0.00' }}
          </div>
        </div>
        
        <!-- Totales generales -->
        <div class="table-footer">
          <div class="col-sucursal"><strong>TOTAL GENERAL</strong></div>
          <div class="col-factor">-</div>
          <div class="col-numero-ganador">
            <strong>L {{ getTotalCantidadNumeroGanador().toFixed(2) }}</strong>
          </div>
          <div class="col-vendido">
            <strong>L {{ getTotalVendidoGeneral() }}</strong>
          </div>
          <div class="col-pagado">
            <strong>L {{ getTotalPagadoGeneral() }}</strong>
          </div>
          <div class="col-ganancia"
               [class.positive]="getGananciaTotalGeneral() > 0"
               [class.negative]="getGananciaTotalGeneral() < 0">
            <strong>L {{ getGananciaTotalGeneral().toFixed(2) }}</strong>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-modal btn-primary" (click)="closeResumenModal()">
        <i class="fas fa-check"></i>
        Entendido
      </button>
    </div>
  </div>
</div>
