<!-- NUEVA INTERFAZ BASADA EN MOCKUPS -->
<div class="lottery-interface">
  <!-- Header -->
  <div class="header-bar">
    <div class="time-display">
      <span class="time-label">Hora Honduras:</span>
      <span class="time-value">{{ currentHondurasTime }}</span>
    </div>
    
    <div class="sucursal-title">
      <h2>{{ currentUser?.sucursal || 'Sucursal 1' }}</h2>
    </div>
    
    <button class="btn-header btn-cerrar" (click)="logout()" [disabled]="isLoading">
      Cerrar Sesión
    </button>
  </div>

  <!-- Contenido Principal -->
  <div class="main-content">
    
    <!-- Vista 1: Pantalla Principal con Botón VENTA -->
    <div *ngIf="selectedNumbers.length === 0" class="venta-screen">
      <div class="venta-button-container">
        <button class="btn-venta" 
                (click)="openNumberModal()" 
                [disabled]="isLoading || isBlocked || !isSorteoOpen">
          VENTA
        </button>
      </div>
      
      <!-- Info del sorteo -->
      <div class="sorteo-info" *ngIf="currentSorteo">
        <div class="alert alert-info">
          <strong>{{ currentSorteo.label }}</strong> - 
          <span *ngIf="isSorteoOpen" class="text-success">
            Abierto (cierra {{ timeUntilClose }})
          </span>
          <span *ngIf="!isSorteoOpen" class="text-danger">
            Cerrado
          </span>
        </div>
      </div>
      
      <!-- Mensaje de bloqueo mejorado -->
      <div *ngIf="isBlocked" class="alert alert-danger block-info">
        <div class="block-header">
          <i class="fas fa-lock"></i> 
          <strong>{{ blockMessage }}</strong>
        </div>
        
        <div class="block-details" *ngIf="blockDetail">
          <p>{{ blockDetail }}</p>
        </div>
        
        <!-- Información detallada del próximo sorteo (solo cuando no hay sorteo activo) -->
        <div *ngIf="nextSorteoName && nextSorteoOpenTime" class="next-sorteo-info">
          <div class="next-sorteo-card">
            <div class="sorteo-name">
              <i class="fas fa-clock"></i>
              <span>{{ nextSorteoName }}</span>
            </div>
            <div class="opening-time">
              <span class="label">Abre a las:</span>
              <span class="time">{{ nextSorteoOpenTime }}</span>
            </div>
            <div class="countdown" *ngIf="timeUntilNextOpening">
              <span class="label">Tiempo restante:</span>
              <span class="time-remaining">{{ timeUntilNextOpening }}</span>
            </div>
          </div>
        </div>
        
        <!-- Mensaje para bloqueo por cierre (últimos 5 minutos) -->
        <div *ngIf="!nextSorteoName && blockDetail.includes('minutos')" class="closing-warning">
          <i class="fas fa-exclamation-triangle"></i>
          <span>El sorteo cerrará pronto</span>
        </div>
      </div>
    </div>

    <!-- Vista 2: Tabla de Jugadas -->
    <div *ngIf="selectedNumbers.length > 0" class="jugadas-screen">
      
      <!-- Tabla de jugadas -->
      <div class="jugadas-table">
        <div class="table-header">
          <div class="col-numero">#</div>
          <div class="col-monto">Monto</div>
          <div class="col-accion"></div>
        </div>
        
        <div class="table-body">
          <div *ngFor="let item of selectedNumbers; let i = index; trackBy: trackByIndex" 
               class="table-row">
            <div class="col-numero">{{ item.numero.toString().padStart(2, '0') }}</div>
            <div class="col-monto">L {{ item.monto.toFixed(0) }}</div>
            <div class="col-accion">
              <button class="btn-remove" (click)="removeNumber(i)" [disabled]="isLoading">
                ×
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Total a Pagar -->
      <div class="total-container">
        <div class="total-card">
          <div class="total-label">Total a Pagar:</div>
          <div class="total-amount">L {{ getTotal().toFixed(2) }}</div>
        </div>
      </div>
      
      <!-- Botón Agregar más números -->
      <div class="add-more-container">
        <button class="btn-add-more" 
                (click)="openNumberModal()" 
                [disabled]="isLoading || isBlocked">
          + Agregar Número
        </button>
      </div>
      
      <!-- Botón PAGAR -->
      <div class="pagar-container">
        <button class="btn-pagar" 
                (click)="processSale()" 
                [disabled]="selectedNumbers.length === 0 || isLoading || isBlocked">
          PAGAR
        </button>
      </div>
    </div>

  </div>

  <!-- TABS DE SORTEOS -->
  <div class="sorteos-tabs-section">
    <div class="tabs-header">
      <button class="tab-btn" 
              [class.active]="activeTab === 'manana'"
              (click)="setActiveTab('manana')">
        <i class="fas fa-sun"></i> Mañana
      </button>
      <button class="tab-btn" 
              [class.active]="activeTab === 'tarde'"
              (click)="setActiveTab('tarde')">
        <i class="fas fa-cloud-sun"></i> Tarde
      </button>
      <button class="tab-btn" 
              [class.active]="activeTab === 'noche'"
              (click)="setActiveTab('noche')">
        <i class="fas fa-moon"></i> Noche
      </button>
    </div>

    <div class="tab-content">
      <!-- Tab Mañana -->
      <div *ngIf="activeTab === 'manana'" class="tab-panel">
        <div class="sorteo-summary">
          <div class="summary-card">
            <div class="summary-label">Total Vendido</div>
            <div class="summary-value">L {{ getSorteoTotalVendido('manana').toFixed(2) }}</div>
          </div>
          <div class="summary-card" *ngIf="getSorteoNumeroGanador('manana') !== null">
            <div class="summary-label">Número Ganador</div>
            <div class="summary-value winner-number">{{ getSorteoNumeroGanador('manana')!.toString().padStart(2, '0') }}</div>
          </div>
          <div class="summary-card" *ngIf="getSorteoTotalPagar('manana') > 0">
            <div class="summary-label">Total a Pagar</div>
            <div class="summary-value payout">L {{ getSorteoTotalPagar('manana').toFixed(2) }}</div>
          </div>
        </div>
        
        <div class="numeros-vendidos">
          <h5>Números Vendidos</h5>
          <div *ngIf="getSorteoNumerosVendidos('manana').length > 0" class="numeros-grid">
            <div *ngFor="let numero of getSorteoNumerosVendidos('manana')" class="numero-vendido-item">
              <span class="numero">{{ numero.numero.toString().padStart(2, '0') }}</span>
              <span class="monto">L {{ numero.total.toFixed(0) }}</span>
            </div>
          </div>
          <div *ngIf="getSorteoNumerosVendidos('manana').length === 0" class="no-data">
            <p>No hay números vendidos para este sorteo</p>
          </div>
        </div>
      </div>

      <!-- Tab Tarde -->
      <div *ngIf="activeTab === 'tarde'" class="tab-panel">
        <div class="sorteo-summary">
          <div class="summary-card">
            <div class="summary-label">Total Vendido</div>
            <div class="summary-value">L {{ getSorteoTotalVendido('tarde').toFixed(2) }}</div>
          </div>
          <div class="summary-card" *ngIf="getSorteoNumeroGanador('tarde') !== null">
            <div class="summary-label">Número Ganador</div>
            <div class="summary-value winner-number">{{ getSorteoNumeroGanador('tarde')!.toString().padStart(2, '0') }}</div>
          </div>
          <div class="summary-card" *ngIf="getSorteoTotalPagar('tarde') > 0">
            <div class="summary-label">Total a Pagar</div>
            <div class="summary-value payout">L {{ getSorteoTotalPagar('tarde').toFixed(2) }}</div>
          </div>
        </div>
        
        <div class="numeros-vendidos">
          <h5>Números Vendidos</h5>
          <div *ngIf="getSorteoNumerosVendidos('tarde').length > 0" class="numeros-grid">
            <div *ngFor="let numero of getSorteoNumerosVendidos('tarde')" class="numero-vendido-item">
              <span class="numero">{{ numero.numero.toString().padStart(2, '0') }}</span>
              <span class="monto">L {{ numero.total.toFixed(0) }}</span>
            </div>
          </div>
          <div *ngIf="getSorteoNumerosVendidos('tarde').length === 0" class="no-data">
            <p>No hay números vendidos para este sorteo</p>
          </div>
        </div>
      </div>

      <!-- Tab Noche -->
      <div *ngIf="activeTab === 'noche'" class="tab-panel">
        <div class="sorteo-summary">
          <div class="summary-card">
            <div class="summary-label">Total Vendido</div>
            <div class="summary-value">L {{ getSorteoTotalVendido('noche').toFixed(2) }}</div>
          </div>
          <div class="summary-card" *ngIf="getSorteoNumeroGanador('noche') !== null">
            <div class="summary-label">Número Ganador</div>
            <div class="summary-value winner-number">{{ getSorteoNumeroGanador('noche')!.toString().padStart(2, '0') }}</div>
          </div>
          <div class="summary-card" *ngIf="getSorteoTotalPagar('noche') > 0">
            <div class="summary-label">Total a Pagar</div>
            <div class="summary-value payout">L {{ getSorteoTotalPagar('noche').toFixed(2) }}</div>
          </div>
        </div>
        
        <div class="numeros-vendidos">
          <h5>Números Vendidos</h5>
          <div *ngIf="getSorteoNumerosVendidos('noche').length > 0" class="numeros-grid">
            <div *ngFor="let numero of getSorteoNumerosVendidos('noche')" class="numero-vendido-item">
              <span class="numero">{{ numero.numero.toString().padStart(2, '0') }}</span>
              <span class="monto">L {{ numero.total.toFixed(0) }}</span>
            </div>
          </div>
          <div *ngIf="getSorteoNumerosVendidos('noche').length === 0" class="no-data">
            <p>No hay números vendidos para este sorteo</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Modal 1: Selección de Número -->
<div class="modal" [style.display]="showNumberModal ? 'flex' : 'none'" 
     [class.show]="showNumberModal" (click)="closeAllModals()">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-hashtag"></i> Seleccionar Número
        </h5>
        <button type="button" class="close" (click)="closeAllModals()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="calculator-container">
          <!-- Display del número -->
          <div class="calculator-display">
            <span class="display-label">NUMERO</span>
            <div class="display-value">{{ (modalNumberInput || '00').padStart(2, '0') }}</div>
          </div>
          
          <!-- Teclado numérico -->
          <div class="calculator-keypad">
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(1); $event.stopPropagation()">1</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(2); $event.stopPropagation()">2</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(3); $event.stopPropagation()">3</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(4); $event.stopPropagation()">4</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(5); $event.stopPropagation()">5</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(6); $event.stopPropagation()">6</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(7); $event.stopPropagation()">7</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(8); $event.stopPropagation()">8</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(9); $event.stopPropagation()">9</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(0); $event.stopPropagation()">0</button>
              <button type="button" class="keypad-btn keypad-clear" (click)="clearModalNumber(); $event.stopPropagation()">
                C
              </button>
              <button type="button" class="keypad-btn keypad-accept" (click)="acceptModalNumber(); $event.stopPropagation()" 
                      [disabled]="!modalNumberInput">
                Aceptar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal 2: Selección de Apuesta -->
<div class="modal" [style.display]="showAmountModal ? 'flex' : 'none'" 
     [class.show]="showAmountModal" (click)="closeAllModals()">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-dollar-sign"></i> Ingresar Apuesta
        </h5>
        <button type="button" class="close" (click)="closeAllModals()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="stepper-container">
          
          <!-- Control Stepper -->
          <div class="stepper-controls">
            <button type="button" 
                    class="stepper-btn stepper-minus" 
                    (click)="decreaseAmount(); $event.stopPropagation()"
                    [disabled]="stepperAmount <= 5">
              <i class="fas fa-minus"></i>
            </button>
            
            <div class="stepper-value">
              <span class="amount-large">{{ stepperAmount }}</span>
              <span class="currency">Lempiras</span>
            </div>
            
            <button type="button" 
                    class="stepper-btn stepper-plus" 
                    (click)="increaseAmount(); $event.stopPropagation()"
                    [disabled]="stepperAmount >= maxAmount">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          
          <!-- Botones de acción -->
          <div class="stepper-actions">
            <button type="button" 
                    class="btn btn-outline-secondary btn-lg stepper-action-btn" 
                    (click)="resetAmount(); $event.stopPropagation()">
              <i class="fas fa-redo"></i> Reiniciar
            </button>
            
            <button type="button" 
                    class="btn btn-success btn-lg stepper-action-btn" 
                    (click)="acceptStepperAmount(); $event.stopPropagation()"
                    [disabled]="stepperAmount < 5">
              <i class="fas fa-check"></i> Aceptar
            </button>
          </div>
          
          <!-- Información adicional -->
          <div class="stepper-info">
            <small class="text-muted">
              <i class="fas fa-info-circle"></i> 
              Monto mínimo: L 5 • Se incrementa de 5 en 5
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal 3: Confirmación -->
<div class="modal" [style.display]="showConfirmModal ? 'flex' : 'none'" 
     [class.show]="showConfirmModal" (click)="closeAllModals()">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-check-circle"></i> Confirmar Apuesta
        </h5>
        <button type="button" class="close" (click)="closeAllModals()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="confirmation-container">
          <div class="confirmation-card">
            <div class="number-display-large">
              # {{ tempNumber !== null ? tempNumber.toString().padStart(2, '0') : '00' }}
            </div>
            <div class="amount-display">
              APUESTA: L {{ tempAmount || 0 }}
            </div>
            <div class="confirmation-buttons">
              <button type="button" class="btn btn-success btn-lg" (click)="confirmAddNumber()">
                <i class="fas fa-check"></i> CONFIRMAR
              </button>
              <button type="button" class="btn btn-secondary btn-lg" (click)="cancelAddNumber()">
                <i class="fas fa-times"></i> Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Eliminar el backdrop separado ya que usamos el modal completo -->
