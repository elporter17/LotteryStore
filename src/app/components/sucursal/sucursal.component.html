<!-- NUEVA INTERFAZ BASADA EN MOCKUPS -->
<div class="lottery-interface">
  <!-- Header -->
  <div class="header-bar">
    <div class="time-display">
      <span class="time-label">Hora Honduras:</span>
      <span class="time-value">{{ currentHondurasTime }}</span>
    </div>
    
    <div class="sucursal-title">
      <h2>{{ currentUser?.sucursal || 'Sucursal 1' }}</h2>
    </div>
    
    <button class="btn-header btn-cerrar" (click)="logout()" [disabled]="isLoading">
      Cerrar Sesi√≥n
    </button>
  </div>

  <!-- Contenido Principal -->
  <div class="main-content">
    
    <!-- Vista 1: Pantalla Principal con Bot√≥n VENTA -->
    <div *ngIf="selectedNumbers.length === 0" class="venta-screen">
      <div class="venta-button-container">
        <button class="btn-venta" 
                (click)="openNumberModal()" 
                [disabled]="isLoading || isBlocked || !isSorteoOpen">
          VENTA
        </button>
      </div>
      
      <!-- Info del sorteo -->
      <div class="sorteo-info" *ngIf="currentSorteo">
        <div class="alert alert-info">
          <strong>{{ currentSorteo.label }}</strong> - 
          <span *ngIf="isSorteoOpen" class="text-success">
            Abierto (cierra {{ timeUntilClose }})
          </span>
          <span *ngIf="!isSorteoOpen" class="text-danger">
            Cerrado
          </span>
        </div>
      </div>
      
      <!-- Mensaje de bloqueo -->
      <div *ngIf="isBlocked" class="alert alert-danger">
        <i class="fas fa-lock"></i> 
        <strong>Venta bloqueada:</strong> Faltan menos de 5 minutos para el cierre del sorteo.
      </div>
    </div>

    <!-- Vista 2: Tabla de Jugadas -->
    <div *ngIf="selectedNumbers.length > 0" class="jugadas-screen">
      
      <!-- Tabla de jugadas -->
      <div class="jugadas-table">
        <div class="table-header">
          <div class="col-numero">#</div>
          <div class="col-monto">Monto</div>
          <div class="col-accion"></div>
        </div>
        
        <div class="table-body">
          <div *ngFor="let item of selectedNumbers; let i = index; trackBy: trackByIndex" 
               class="table-row">
            <div class="col-numero">{{ item.numero.toString().padStart(2, '0') }}</div>
            <div class="col-monto">L {{ item.monto.toFixed(0) }}</div>
            <div class="col-accion">
              <button class="btn-remove" (click)="removeNumber(i)" [disabled]="isLoading">
                √ó
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Bot√≥n Agregar m√°s n√∫meros -->
      <div class="add-more-container">
        <button class="btn-add-more" 
                (click)="openNumberModal()" 
                [disabled]="isLoading || isBlocked">
          + Agregar N√∫mero
        </button>
      </div>
      
      <!-- Bot√≥n PAGAR -->
      <div class="pagar-container">
        <button class="btn-pagar" 
                (click)="processSale()" 
                [disabled]="selectedNumbers.length === 0 || isLoading || isBlocked">
          PAGAR
        </button>
      </div>
    </div>

  </div>

  <!-- Ventas Actuales (siempre visible en la parte inferior) -->
  <div class="ventas-actuales" *ngIf="recentSales.length > 0">
    <div class="ventas-header">
      <h4>Ventas actuales</h4>
    </div>
    
    <div class="ventas-body">
      <div class="transacciones-header">
        Transacciones
      </div>
      
      <div *ngFor="let sale of getFilteredSales(); trackBy: trackBySaleId" class="transaccion-item">
        <div class="transaccion-left">
          <div class="fecha-hora">{{ formatTime(sale.createdAt) }}</div>
          <div class="numero-recibo">Recibo: {{ sale.numeroRecibo || sale.id.slice(-6) }}</div>
          <div class="correlativo">Correlativo: {{ sale.correlativo || 'N/A' }}</div>
          <div class="numeros-jugados">
            <span *ngFor="let detail of getSaleDetails(sale.id); trackBy: trackByDetailId" class="numero-small">
              {{ detail.numero.toString().padStart(2, '0') }} x L{{ detail.monto.toFixed(0) }}
            </span>
          </div>
        </div>
        <div class="transaccion-right">
          <div class="total">Total: L{{ sale.total.toFixed(0) }}</div>
          <button class="btn-reimprimir" (click)="reprintReceipt(sale)">
            üñ®Ô∏è Reimprimir
          </button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Modal 1: Selecci√≥n de N√∫mero -->
<div class="modal" [style.display]="showNumberModal ? 'flex' : 'none'" 
     [class.show]="showNumberModal" (click)="closeAllModals()">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-hashtag"></i> Seleccionar N√∫mero
        </h5>
        <button type="button" class="close" (click)="closeAllModals()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="calculator-container">
          <!-- Display del n√∫mero -->
          <div class="calculator-display">
            <span class="display-label">NUMERO</span>
            <div class="display-value">{{ (modalNumberInput || '00').padStart(2, '0') }}</div>
          </div>
          
          <!-- Teclado num√©rico -->
          <div class="calculator-keypad">
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(1); $event.stopPropagation()">1</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(2); $event.stopPropagation()">2</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(3); $event.stopPropagation()">3</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(4); $event.stopPropagation()">4</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(5); $event.stopPropagation()">5</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(6); $event.stopPropagation()">6</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(7); $event.stopPropagation()">7</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(8); $event.stopPropagation()">8</button>
              <button type="button" class="keypad-btn" (click)="pressModalNumber(9); $event.stopPropagation()">9</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalNumber(0); $event.stopPropagation()">0</button>
              <button type="button" class="keypad-btn keypad-clear" (click)="clearModalNumber(); $event.stopPropagation()">
                C
              </button>
              <button type="button" class="keypad-btn keypad-accept" (click)="acceptModalNumber(); $event.stopPropagation()" 
                      [disabled]="!modalNumberInput">
                Aceptar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal 2: Selecci√≥n de Apuesta -->
<div class="modal" [style.display]="showAmountModal ? 'flex' : 'none'" 
     [class.show]="showAmountModal" (click)="closeAllModals()">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-dollar-sign"></i> Ingresar Apuesta
        </h5>
        <button type="button" class="close" (click)="closeAllModals()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="calculator-container">
          <!-- Display de la apuesta -->
          <div class="calculator-display">
            <span class="display-label">APUESTA</span>
            <div class="display-value">{{ modalAmountInput || '00' }}</div>
          </div>
          
          <!-- Teclado num√©rico -->
          <div class="calculator-keypad">
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalAmount(1); $event.stopPropagation()">1</button>
              <button type="button" class="keypad-btn" (click)="pressModalAmount(2); $event.stopPropagation()">2</button>
              <button type="button" class="keypad-btn" (click)="pressModalAmount(3); $event.stopPropagation()">3</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalAmount(4); $event.stopPropagation()">4</button>
              <button type="button" class="keypad-btn" (click)="pressModalAmount(5); $event.stopPropagation()">5</button>
              <button type="button" class="keypad-btn" (click)="pressModalAmount(6); $event.stopPropagation()">6</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalAmount(7); $event.stopPropagation()">7</button>
              <button type="button" class="keypad-btn" (click)="pressModalAmount(8); $event.stopPropagation()">8</button>
              <button type="button" class="keypad-btn" (click)="pressModalAmount(9); $event.stopPropagation()">9</button>
            </div>
            <div class="keypad-row">
              <button type="button" class="keypad-btn" (click)="pressModalAmount(0); $event.stopPropagation()">0</button>
              <button type="button" class="keypad-btn keypad-clear" (click)="clearModalAmount(); $event.stopPropagation()">
                C
              </button>
              <button type="button" class="keypad-btn keypad-accept" (click)="acceptModalAmount(); $event.stopPropagation()" 
                      [disabled]="!modalAmountInput">
                Aceptar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal 3: Confirmaci√≥n -->
<div class="modal" [style.display]="showConfirmModal ? 'flex' : 'none'" 
     [class.show]="showConfirmModal" (click)="closeAllModals()">
  <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-check-circle"></i> Confirmar Apuesta
        </h5>
        <button type="button" class="close" (click)="closeAllModals()">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="confirmation-container">
          <div class="confirmation-card">
            <div class="number-display-large">
              # {{ tempNumber !== null ? tempNumber.toString().padStart(2, '0') : '00' }}
            </div>
            <div class="amount-display">
              APUESTA: L {{ tempAmount || 0 }}
            </div>
            <div class="confirmation-buttons">
              <button type="button" class="btn btn-success btn-lg" (click)="confirmAddNumber()">
                <i class="fas fa-check"></i> CONFIRMAR
              </button>
              <button type="button" class="btn btn-secondary btn-lg" (click)="cancelAddNumber()">
                <i class="fas fa-times"></i> Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Eliminar el backdrop separado ya que usamos el modal completo -->
